# Fortify-Integration for Service-Owners

The contents of this project are provided as an `include`able, "stageless" pipeline. To facilitate [project-owners' integration tasks]() it will be necessary for the GitLab and Fortify service-owners to perform tasks within their own services.
    
## Fortiy Service-Owner tasks

It is currently expected that a common credential to be used by all GitLab/SSC service-consumers. The Fortify service-owner will need to generate a SSC service-user. This user should have the bare-minimum permissions necessary to create new projects and project-versions and to upload and download security-artifacts to the projects hosted in SSC. This username should be communicated to the GitLab service-owner (who will store it as the value for the `SSC_USER_NAME` CI-variable).

### Service-user Password

The user should have a agency-compliant password-string generated. Ideally, the password will have no expiry associated with it as having an expiry-date will cause the GitLab/SSC integration to fail upon expiry and may introduce undesirable service-interruptions into Fortify-integrated pipelines. This password should be communicated to the GitLab service-owner (who will store it as the value for the `SSC_USER_PASS` CI-variable) via encrypted communication-channel.

### Service-user API token

It is expected that this credential will only be used for fetching an ephemeral, 'UnifiedLoginToken' API-token from SSC. This token will need to be of the `CI` token-type. Similar to the service-user password, this token should be non-expiring. This token-string should be communicated to the GitLab service-owner (who will store it as the value for the `SSC_TRANSFER_TOKEN` CI-variable) via encrypted communication-channel.

### SSC Project (Application) Creation

It is expected that each SSC-enabled project will be assigned a unique name within the SSC domain's name-space. It is further assumed that the SSC project name _may_ be different from that of the project within the GitLab service-domain. Upon creation of the SSC project-space, the capitalization-sensitive project name-string will be communicated to the GitLab project-owner (who will store it as the value for their project-space's `SSC_APP_NAME` value).


## GitLab Service-Owner tasks

To reduce the number of group- or repository-level settings that GitLab users need to make, it is expected that the GitLab service-owners will globally define several Fortify-related CI variables:

* `FORTIFY_CI_TEMPLATE_PROJECT`: Location/path of the project containing the `include`able Fortify-inetgration templates
* `FORTIFY_CI_TEMPLATE_BRANCH`: The branch-name that contains the _stable_ `include`able Fortify-inetgration templates (currently `main`)
* `FORTIFY_CONTAINER_DEFAULT`: The container used for basic (non-specialty), container-based GitLab-CI tasks. It's expected that this container will be of a `python:3` type (during testing, `bluefactory/docker/python:3.10.2-1` was used)
* `FORTIFY_CONTAINER_EXPORTER`: Name of the Fortify vulnerability-exporter Docker container (during testing, this will be `rogue-squadron-sandbox/ssc-integration/docker/fortify-vulnerability-exporter-dod:v1.4.1`)
* `FORTIFY_CONTAINER_SCA`:  Name of the Fortify SCA Docker container (typically, this will be `fortify-sca:latest` under the target-network's `dso-millennium-falcon/docker` registry-path; during testing, this was `rogue-squadron-sandbox/ssc-integration/docker/fortify-sca-dod`)
* `FORTIFY_CONTAINER_VERSUTIL`:  Name of the Docker-container that contains the Fortify version-utility (during testing, this will be `rogue-squadron-sandbox/ssc-integration/docker/ssc-version-util:ubi8`)
* `SSC_URL`: The fully-qualified domain-name of the SSC server (during testing, this was `ssc.dso.test.xc.nga.mil` &ndash; note the _absence_ of `http://` or `https://` in this string)
* `SSC_USER_NAME`: The SSC service-user created for the project-space within SSC
* `SSC_USER_PASS`: The cleartext password of the SSC service-user created for the project-space within SSC. Ensure that the CI-variable is set to `Masked`
* `SSC_TRANSFER_TOKEN`: The API token generated by the SSC service-administrator to access SSC resources delegated to the SSC service-user. The SSC-administrator will create this token as a `CIToken` token-type). Ensure that the CI-variable is set to `Masked`

Note: the `SSC_USER_*` and `SSC_TANSFER_TOKEN` parameter/values are, as of this writing, assumed to be a common credential to be used by all GitLab/SSC service-consumers. If this expectation changes, the `SSC_USER_*` and `SSC_TANSFER_TOKEN` variables should remain un-set in the GitLab-service's global CI variable-space
